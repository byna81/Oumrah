<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#059669">
<title>Gestion Groupe Oumrah</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#d1fae5 0%,#99f6e4 50%,#a5f3fc 100%);min-height:100vh;padding-bottom:100px}
.container{max-width:600px;margin:0 auto;padding:20px}
.card{background:white;border-radius:20px;padding:30px;box-shadow:0 10px 30px rgba(0,0,0,0.1);margin-bottom:20px}
h1{color:#047857;font-size:28px;margin-bottom:10px;text-align:center}
h2{color:#047857;font-size:22px;margin-bottom:15px}
h3{color:#059669;font-size:18px;margin-bottom:10px}
p{color:#4b5563;line-height:1.6;margin-bottom:10px}
button{width:100%;padding:15px;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s;margin-bottom:10px}
.btn-primary{background:linear-gradient(135deg,#059669 0%,#0d9488 100%);color:white;box-shadow:0 4px 15px rgba(5,150,105,0.3)}
.btn-primary:active{transform:scale(0.98)}
.btn-secondary{background:white;border:2px solid #059669;color:#059669}
.btn-small{width:auto;padding:8px 15px;font-size:14px;display:inline-block}
.btn-danger{background:#ef4444;color:white}
.btn-success{background:#10b981;color:white}
.btn-warning{background:#f59e0b;color:white}
.btn-completed{background:#10b981;color:white}
input,select,textarea{width:100%;padding:12px;border:2px solid #d1d5db;border-radius:10px;font-size:16px;margin-bottom:15px}
textarea{min-height:100px;font-family:inherit}
input:focus,select:focus,textarea:focus{outline:none;border-color:#059669}
.hidden{display:none}
.tab-bar{background:white;position:sticky;top:0;z-index:100;display:flex;box-shadow:0 2px 10px rgba(0,0,0,0.1);overflow-x:auto}
.tab{flex:1;min-width:70px;padding:15px 10px;text-align:center;border:none;background:white;color:#6b7280;font-weight:600;font-size:12px;border-bottom:3px solid transparent;cursor:pointer;white-space:nowrap}
.tab.active{color:#059669;border-bottom-color:#059669}
.header{background:white;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.05);margin-bottom:20px}
.profile-section{background:linear-gradient(135deg,#f0fdf4 0%,#dcfce7 100%);padding:20px;border-radius:15px;text-align:center;margin-bottom:20px;border:2px solid #059669}
.profile-photo{width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg,#059669 0%,#0d9488 100%);margin:0 auto 15px;display:flex;align-items:center;justify-content:center;color:white;font-size:40px;font-weight:bold;box-shadow:0 4px 15px rgba(5,150,105,0.3);overflow:hidden}
.profile-photo img{width:100%;height:100%;object-fit:cover}
.icon-circle{width:60px;height:60px;background:linear-gradient(135deg,#059669 0%,#0d9488 100%);border-radius:50%;margin:0 auto 15px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(5,150,105,0.3)}
.code-display{background:#d1fae5;padding:15px;border-radius:10px;text-align:center;font-family:monospace;font-size:24px;font-weight:bold;color:#047857;margin:15px 0}
.pilgrim-item,.message-item,.activity-item,.question-item{background:#f9fafb;padding:15px;border-radius:10px;margin-bottom:10px;border:2px solid #e5e7eb}
.status-online,.status-offline{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:5px}
.status-online{background:#10b981}
.status-offline{background:#6b7280}
.badge{display:inline-block;padding:4px 10px;border-radius:20px;font-size:12px;font-weight:600;margin:5px 5px 5px 0}
.badge-present{background:#dcfce7;color:#166534}
.badge-absent{background:#fee2e2;color:#991b1b}
.badge-info{background:#dbeafe;color:#1e40af}
.badge-warning{background:#fef3c7;color:#92400e}
.badge-success{background:#d1fae5;color:#065f46}
.progress-bar{width:100%;height:10px;background:#e5e7eb;border-radius:10px;overflow:hidden;margin:10px 0}
.progress-fill{height:100%;background:linear-gradient(90deg,#059669 0%,#10b981 100%);transition:width 0.3s}
.progress-text{font-size:14px;font-weight:600;color:#059669;text-align:center;margin-top:5px}
.rite-item{border:2px solid #d1fae5;border-radius:15px;margin-bottom:15px;overflow:hidden}
.rite-item.completed{border-color:#10b981;background:#f0fdf4}
.rite-header{padding:20px;background:white;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.rite-header:active{background:#f0fdf4}
.rite-number{width:40px;height:40px;background:linear-gradient(135deg,#059669 0%,#0d9488 100%);color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:18px;margin-right:15px;flex-shrink:0}
.rite-number.completed{background:linear-gradient(135deg,#10b981 0%,#059669 100%)}
.rite-content{padding:20px;background:#f0fdf4;border-top:2px solid #d1fae5}
.dua-box{background:white;padding:15px;border-radius:10px;margin-bottom:10px;border:1px solid #d1fae5}
.arabic-text{font-size:24px;line-height:1.8;text-align:right;direction:rtl;color:#1f2937}
.phonetic-text{font-style:italic;color:#6b7280;font-size:14px}
.translation-text{color:#374151;font-size:14px}
.counter-circle{width:150px;height:150px;background:linear-gradient(135deg,#059669 0%,#0d9488 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:20px auto;box-shadow:0 10px 30px rgba(5,150,105,0.4)}
.counter-number{font-size:60px;font-weight:bold;color:white}
.success-box{background:#dcfce7;border:2px solid #22c55e;padding:15px;border-radius:10px;text-align:center;margin-bottom:15px}
.success-text{color:#166534;font-weight:bold;font-size:16px}
.flex-row{display:flex;gap:10px;align-items:center}
.flex-between{display:flex;justify-content:space-between;align-items:center}
.guide-location-card{background:linear-gradient(135deg,#dbeafe 0%,#bfdbfe 100%);border:2px solid #3b82f6;border-radius:15px;padding:20px;margin-bottom:20px}
.distance-display{font-size:32px;font-weight:bold;color:#1e40af;text-align:center;margin:10px 0}
.map-placeholder{background:linear-gradient(135deg,#d1fae5 0%,#a5f3fc 100%);height:200px;border-radius:15px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border:2px solid #059669}
.question-response{background:#f0fdf4;padding:10px;border-left:4px solid #059669;margin-top:10px;border-radius:5px}
ol{margin-left:20px;margin-bottom:15px}
ol li{margin-bottom:8px;color:#374151}
.label{font-size:12px;font-weight:600;color:#047857;margin-bottom:5px;display:block}
.message-time{font-size:12px;color:#6b7280}
.message-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.checkmark{color:#10b981;font-size:20px;margin-left:10px}
.checkbox-item{display:flex;align-items:center;padding:10px;margin-bottom:5px;background:white;border-radius:8px}
.checkbox-item input[type="checkbox"]{width:20px;height:20px;margin-right:10px}
</style>
</head>
<body>
<div id="app"></div>
<script>
let S={lang:'fr',userType:null,userName:'',userPhoto:null,userHotel:'',userRoom:'',pilgrimCode:'',groupCode:'',currentGroup:null,activeTab:'rites',expandedRite:null,tawafCount:0,saiCount:0,messages:[],pilgrims:[],activities:[],questions:[],completedSteps:{},pilgrimPresence:{},guideLocation:{lat:21.4225,lng:39.8262},showAddMessage:false,showAddPilgrim:false,showAddActivity:false,showAskQuestion:false,showEditPilgrim:false,editPilgrimId:null,viewPilgrimProgress:null,viewQuestions:false};
const T={fr:{appTitle:"Gestion Groupe Oumrah",guide:"Guide",pilgrims:"PÃ¨lerins",userType:"Choisissez votre rÃ´le",enterName:"Entrez votre nom complet",uploadPhoto:"Ajouter une photo (optionnel)",create:"CrÃ©er un groupe",join:"Rejoindre",enterCode:"Entrez le code du groupe",yourCode:"Votre code de groupe :",shareCode:"Partagez ce code avec vos pÃ¨lerins",rites:"Rites",detailedGuide:"Guide dÃ©taillÃ©",messages:"Messages",rooms:"Chambres",map:"Carte",presence:"PrÃ©sence",progress:"Progression",guideLocation:"Localisation Guide",activities:"ActivitÃ©s",questions:"Questions au Guide",steps:"Ã‰tapes",invocation:"Invocation",phonetic:"PhonÃ©tique",translation:"Traduction",counter:"Compteur",round:"Tour",trip:"Trajet",reset:"RÃ©initialiser",tawafComplete:"Tawaf terminÃ© ! 7 tours accomplis âœ“",saiComplete:"Sa'i terminÃ© ! 7 trajets accomplis âœ“",back:"â† Retour",addMessage:"Nouveau message",messageTitle:"Titre du message",messageContent:"Contenu du message",send:"Envoyer",cancel:"Annuler",noMessages:"Aucun message pour le moment",addPilgrim:"Ajouter un pÃ¨lerin",pilgrimName:"Nom du pÃ¨lerin",roomNumber:"NumÃ©ro de chambre",floor:"Ã‰tage",save:"Enregistrer",noPilgrims:"Aucun pÃ¨lerin enregistrÃ©",room:"Chambre",online:"En ligne",offline:"Hors ligne",addActivity:"Nouvelle activitÃ©",activityName:"Nom de l'activitÃ©",activityLocation:"Lieu",activityTime:"Heure",noActivities:"Aucune activitÃ© planifiÃ©e",markPresence:"Marquer les prÃ©sences",present:"PrÃ©sent",absent:"Absent",presenceCount:"prÃ©sents",delete:"Supprimer",myProgress:"Ma progression",completed:"âœ“ TerminÃ©",notStarted:"Pas commencÃ©",markComplete:"Marquer comme terminÃ©",viewProgress:"Voir la progression",pilgrimProgress:"Progression du pÃ¨lerin",of:"sur",stepsCompleted:"Ã©tapes terminÃ©es",guideDistance:"Distance du guide",meters:"mÃ¨tres",findGuide:"Localiser le guide",askQuestion:"Poser une question",questionPlaceholder:"DÃ©crivez votre problÃ¨me ou question...",yourQuestions:"Vos questions",noQuestions:"Aucune question posÃ©e",awaitingResponse:"En attente de rÃ©ponse",answered:"RÃ©pondu",validatePresence:"Valider ma prÃ©sence",presenceValidated:"âœ“ PrÃ©sence validÃ©e",myActivities:"Mes activitÃ©s",answer:"RÃ©pondre",response:"RÃ©ponse",pilgrimsQuestions:"Questions des pÃ¨lerins"},en:{appTitle:"Umrah Group Management",guide:"Guide",pilgrims:"Pilgrims",userType:"Choose your role",enterName:"Enter your full name",uploadPhoto:"Add photo (optional)",create:"Create group",join:"Join",enterCode:"Enter group code",yourCode:"Your group code:",shareCode:"Share this code with your pilgrims",rites:"Rites",detailedGuide:"Detailed Guide",messages:"Messages",rooms:"Rooms",map:"Map",presence:"Attendance",progress:"Progress",guideLocation:"Guide Location",activities:"Activities",questions:"Questions to Guide",steps:"Steps",invocation:"Invocation",phonetic:"Phonetic",translation:"Translation",counter:"Counter",round:"Round",trip:"Trip",reset:"Reset",tawafComplete:"Tawaf completed! 7 rounds done âœ“",saiComplete:"Sa'i completed! 7 trips done âœ“",back:"â† Back",addMessage:"New message",messageTitle:"Message title",messageContent:"Message content",send:"Send",cancel:"Cancel",noMessages:"No messages yet",addPilgrim:"Add pilgrim",pilgrimName:"Pilgrim name",roomNumber:"Room number",floor:"Floor",save:"Save",noPilgrims:"No pilgrims registered",room:"Room",online:"Online",offline:"Offline",addActivity:"New activity",activityName:"Activity name",activityLocation:"Location",activityTime:"Time",noActivities:"No activities planned",markPresence:"Mark attendance",present:"Present",absent:"Absent",presenceCount:"present",delete:"Delete",myProgress:"My progress",completed:"âœ“ Completed",notStarted:"Not started",markComplete:"Mark as completed",viewProgress:"View progress",pilgrimProgress:"Pilgrim progress",of:"of",stepsCompleted:"steps completed",guideDistance:"Distance to guide",meters:"meters",findGuide:"Find guide",askQuestion:"Ask question",questionPlaceholder:"Describe your issue or question...",yourQuestions:"Your questions",noQuestions:"No questions asked",awaitingResponse:"Awaiting response",answered:"Answered",validatePresence:"Validate my presence",presenceValidated:"âœ“ Presence validated",myActivities:"My activities",answer:"Answer",response:"Response",pilgrimsQuestions:"Pilgrims questions"}};
const RITES={fr:[{id:1,title:"Ihram",description:"Ã‰tat de sacralisation avant d'entrer dans les lieux saints",steps:["Se purifier (ghusl) et porter les vÃªtements d'Ihram","Formuler l'intention (niyyah) pour la Oumrah","RÃ©citer la Talbiyah"],dua:{arabic:"Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙØŒ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙƒÙ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙØŒ Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙØ§Ù„Ù†ÙÙ‘Ø¹Ù’Ù…ÙØ©Ù Ù„ÙÙƒÙ ÙˆÙØ§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙØŒ Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙƒÙ",phonetic:"Labbayka AllÄhumma labbayk, labbayka lÄ sharÄ«ka laka labbayk, inna al-á¸¥amda wa n-niÊ¿mata laka wa l-mulk, lÄ sharÄ«ka lak",translation:"Me voici, Ã” Allah, me voici. Me voici, Tu n'as pas d'associÃ©, me voici. Certes la louange, la grÃ¢ce et la royautÃ© T'appartiennent. Tu n'as pas d'associÃ©."}},{id:2,title:"Tawaf",description:"Sept circumambulations autour de la Kaaba",steps:["Commencer au niveau de la Pierre Noire (Hajar al-Aswad)","Effectuer 7 tours autour de la Kaaba dans le sens antihoraire","Toucher ou pointer la Pierre Noire Ã  chaque tour si possible","RÃ©citer les invocations pendant le Tawaf"],dua:{arabic:"Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‡Ù ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù ÙˆÙÙ„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„Ù‡Ù ÙˆÙØ§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù ÙˆÙÙ„ÙØ§ Ø­ÙÙˆÙ’Ù„Ù ÙˆÙÙ„ÙØ§ Ù‚ÙÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„Ù‡Ù",phonetic:"Subá¸¥Äna LlÄh, wa l-á¸¥amdu li-LlÄh, wa lÄ ilÄha illÄ LlÄh, wa LlÄhu akbar, wa lÄ á¸¥awla wa lÄ quwwata illÄ bi-LlÄh",translation:"Gloire Ã  Allah, louange Ã  Allah, il n'y a de divinitÃ© qu'Allah, Allah est le Plus Grand, il n'y a de force ni de puissance qu'en Allah."}},{id:3,title:"PriÃ¨re de deux unitÃ©s",description:"PriÃ¨re derriÃ¨re Maqam Ibrahim",steps:["Se diriger vers Maqam Ibrahim aprÃ¨s le Tawaf","Accomplir deux rak'at (unitÃ©s de priÃ¨re)","RÃ©citer sourate Al-Kafirun dans la 1Ã¨re rak'a","RÃ©citer sourate Al-Ikhlas dans la 2Ã¨me rak'a"],dua:{arabic:"Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ ØªÙÙ‚ÙØ¨ÙÙ‘Ù„Ù’ Ù…ÙÙ†ÙÙ‘Ø§ Ø¥ÙÙ†ÙÙ‘ÙƒÙ Ø£ÙÙ†Ù’ØªÙ Ø§Ù„Ø³ÙÙ‘Ù…ÙÙŠØ¹Ù Ø§Ù„Ù’Ø¹ÙÙ„ÙÙŠÙ…Ù",phonetic:"RabbanÄ taqabbal minnÄ innaka anta s-samÄ«Ê¿u l-Ê¿alÄ«m",translation:"Notre Seigneur, accepte de nous, Tu es certes Celui qui entend et qui sait."}},{id:4,title:"Sa'i",description:"Sept allers-retours entre Safa et Marwa",steps:["Arriver au pied du mont Safa et rÃ©citer le verset","Monter sur Safa en regardant la Kaaba","RÃ©citer le Takbir (3 fois)","Marcher vers Marwa (1er trajet)","RÃ©pÃ©ter jusqu'Ã  complÃ©ter 7 trajets (fin Ã  Marwa)"],dua:{arabic:"Ø¥ÙÙ†ÙÙ‘ Ø§Ù„ØµÙÙ‘ÙÙØ§ ÙˆÙØ§Ù„Ù’Ù…ÙØ±Ù’ÙˆÙØ©Ù Ù…ÙÙ†Ù’ Ø´ÙØ¹ÙØ§Ø¦ÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙÙÙ…ÙÙ†Ù’ Ø­ÙØ¬ÙÙ‘ Ø§Ù„Ù’Ø¨ÙÙŠÙ’ØªÙ Ø£Ùˆ Ø§Ø¹Ù’ØªÙÙ…ÙØ±Ù ÙÙÙ„ÙØ§ Ø¬ÙÙ†ÙØ§Ø­Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡Ù Ø£ÙÙ†Ù’ ÙŠÙØ·ÙÙˆÙÙ‘ÙÙ Ø¨ÙÙ‡ÙÙ…ÙØ§ ÙˆÙÙ…ÙÙ†Ù’ ØªÙØ·ÙÙˆÙÙ‘Ø¹Ù Ø®ÙÙŠÙ’Ø±Ù‹Ø§ ÙÙØ¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø´ÙØ§ÙƒÙØ±ÙŒ Ø¹ÙÙ„ÙÙŠÙ…ÙŒ â€¢ Ø§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±ÙØŒ Ø§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±ÙØŒ Ø§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù",phonetic:"Inna-s-safa wa-l-marwata min cha'aa-iri Llahi, faman hadja-l-bayta awi 'tamara fala djounaaha 'alayhi an yattawwafa bihima, wa man ta tawwa'a khayran fa inna Allaha chaa kiroun 'alim â€¢ Allahou Akbar, Allahou Akbar, Allahou Akbar",translation:"AS-SAFA et AL-MARWA sont vraiment parmi les lieux sacrÃ©s d'ALLAH. Donc, quiconque fait le pÃ¨lerinage Ã  la Maison (SacrÃ©e) ou fait la OMRA ne commet pas de pÃ©chÃ© en faisant le va-et-vient entre ces deux monts. Et quiconque fait de son propre grÃ© une bonne Å“uvre, alors ALLAH est Reconnaissant, Omniscient â€¢ Allah est le Plus Grand, Allah est le Plus Grand, Allah est le Plus Grand."}},{id:5,title:"Taqsir ou Halq",description:"Raccourcir ou raser les cheveux",steps:["Les hommes peuvent raser (Halq) ou raccourcir (Taqsir) leurs cheveux","Les femmes coupent l'Ã©quivalent d'une phalange de leurs cheveux","Ceci marque la fin de la Oumrah","L'Ã©tat d'Ihram prend fin"],dua:{arabic:"Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ù‚ÙØ¶ÙÙ‰ Ø¹ÙÙ†ÙÙ‘Ø§ Ù†ÙØ³ÙÙƒÙÙ†ÙØ§",phonetic:"Al-á¸¥amdu li-LlÄhi lladhÄ« qaá¸Ä Ê¿annÄ nusukana",translation:"Louange Ã  Allah qui nous a permis d'accomplir notre rite."}}],en:[{id:1,title:"Ihram",description:"State of consecration",steps:["Perform purification (ghusl)","Make intention (niyyah)","Recite the Talbiyah"],dua:{arabic:"Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙØŒ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙƒÙ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙØŒ Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙØ§Ù„Ù†ÙÙ‘Ø¹Ù’Ù…ÙØ©Ù Ù„ÙÙƒÙ ÙˆÙØ§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙØŒ Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙƒÙ",phonetic:"Labbayka AllÄhumma labbayk",translation:"Here I am, O Allah"}},{id:2,title:"Tawaf",description:"Seven circumambulations",steps:["Start at Black Stone","Perform 7 circles counterclockwise","Touch or point to Black Stone","Recite invocations"],dua:{arabic:"Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‡Ù ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù ÙˆÙÙ„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„Ù‡Ù ÙˆÙØ§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù ÙˆÙÙ„ÙØ§ Ø­ÙÙˆÙ’Ù„Ù ÙˆÙÙ„ÙØ§ Ù‚ÙÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„Ù‡Ù",phonetic:"Subá¸¥Äna LlÄh",translation:"Glory be to Allah"}},{id:3,title:"Two units prayer",description:"Prayer behind Maqam Ibrahim",steps:["Go to Maqam Ibrahim","Perform two rak'at","Recite Surah Al-Kafirun","Recite Surah Al-Ikhlas"],dua:{arabic:"Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ ØªÙÙ‚ÙØ¨ÙÙ‘Ù„Ù’ Ù…ÙÙ†ÙÙ‘Ø§ Ø¥ÙÙ†ÙÙ‘ÙƒÙ Ø£ÙÙ†Ù’ØªÙ Ø§Ù„Ø³ÙÙ‘Ù…ÙÙŠØ¹Ù Ø§Ù„Ù’Ø¹ÙÙ„ÙÙŠÙ…Ù",phonetic:"RabbanÄ taqabbal minnÄ",translation:"Our Lord, accept from us"}},{id:4,title:"Sa'i",description:"Seven trips between Safa and Marwa",steps:["Arrive at mount Safa and recite verse","Climb Safa facing Kaaba","Recite Takbir (3 times)","Walk to Marwa","Complete 7 trips"],dua:{arabic:"Ø¥ÙÙ†ÙÙ‘ Ø§Ù„ØµÙÙ‘ÙÙØ§ ÙˆÙØ§Ù„Ù’Ù…ÙØ±Ù’ÙˆÙØ©Ù Ù…ÙÙ†Ù’ Ø´ÙØ¹ÙØ§Ø¦ÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙÙÙ…ÙÙ†Ù’ Ø­ÙØ¬ÙÙ‘ Ø§Ù„Ù’Ø¨ÙÙŠÙ’ØªÙ Ø£Ùˆ Ø§Ø¹Ù’ØªÙÙ…ÙØ±Ù ÙÙÙ„ÙØ§ Ø¬ÙÙ†ÙØ§Ø­Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡Ù Ø£ÙÙ†Ù’ ÙŠÙØ·ÙÙˆÙÙ‘ÙÙ Ø¨ÙÙ‡ÙÙ…ÙØ§ ÙˆÙÙ…ÙÙ†Ù’ ØªÙØ·ÙÙˆÙÙ‘Ø¹Ù Ø®ÙÙŠÙ’Ø±Ù‹Ø§ ÙÙØ¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø´ÙØ§ÙƒÙØ±ÙŒ Ø¹ÙÙ„ÙÙŠÙ…ÙŒ â€¢ Ø§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±ÙØŒ Ø§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±ÙØŒ Ø§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù",phonetic:"Inna-s-safa wa-l-marwata min cha'aa-iri Llahi â€¢ Allahou Akbar, Allahou Akbar, Allahou Akbar",translation:"Indeed, Safa and Marwa are sacred places â€¢ Allah is the Greatest (3x)"}},{id:5,title:"Taqsir or Halq",description:"Shortening or shaving hair",steps:["Men can shave or shorten","Women cut fingertip length","Marks end of Umrah","Ihram state ends"],dua:{arabic:"Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ù‚ÙØ¶ÙÙ‰ Ø¹ÙÙ†ÙÙ‘Ø§ Ù†ÙØ³ÙÙƒÙÙ†ÙØ§",phonetic:"Al-á¸¥amdu li-LlÄhi",translation:"Praise be to Allah"}}]};
function initDemo(){if(S.userType==='guide'&&S.currentGroup&&S.pilgrims.length===0){S.pilgrims=[{id:1,name:'Ahmed Ben Ali',hotel:'Hilton Makkah',room:'205',code:'ABC123',groupCode:S.currentGroup,photo:null,online:true,lat:21.4225,lng:39.8262,completedSteps:{1:true,2:true,3:false,4:false,5:false}},{id:2,name:'Fatima Zahra',hotel:'Hilton Makkah',room:'207',code:'DEF456',groupCode:S.currentGroup,photo:null,online:true,lat:21.4235,lng:39.8272,completedSteps:{1:true,2:true,3:true,4:true,5:false}},{id:3,name:'Mohammed Ibrahim',hotel:'Swissotel Makkah',room:'305',code:'GHI789',groupCode:S.currentGroup,photo:null,online:false,lat:21.4215,lng:39.8252,completedSteps:{1:true,2:false,3:false,4:false,5:false}},{id:4,name:'Khadija Nour',hotel:'Swissotel Makkah',room:'308',code:'JKL012',groupCode:S.currentGroup,photo:null,online:true,lat:21.4240,lng:39.8280,completedSteps:{1:true,2:true,3:true,4:true,5:true}}];localStorage.setItem('pilgrims',JSON.stringify(S.pilgrims));S.messages=[{id:1,title:'DÃ©part demain matin',content:'Rendez-vous Ã  6h dans le lobby',time:new Date(Date.now()-3600000)}];S.activities=[{id:1,name:'Visite MosquÃ©e du ProphÃ¨te',location:'MÃ©dine',time:'09:00',presence:{}},{id:2,name:'Tawaf de groupe',location:'Masjid al-Haram',time:'14:00',presence:{}}];S.questions=[{id:1,pilgrimName:'Ahmed Ben Ali',pilgrimId:1,question:'Je ne trouve pas mon groupe pour le Tawaf',time:new Date(Date.now()-1800000),answered:false,response:null}]}}
function fmtTime(d){const n=new Date(),diff=n-d,m=Math.floor(diff/60000),h=Math.floor(m/60),day=Math.floor(h/24);if(m<1)return "Ã  l'instant";if(m<60)return `il y a ${m} min`;if(h<24)return `il y a ${h}h`;return `il y a ${day}j`}
function calcProg(c){if(!c)return 0;const comp=Object.values(c).filter(v=>v).length;return Math.round((comp/5)*100)}
function getCnt(c){if(!c)return 0;return Object.values(c).filter(v=>v).length}
function calcDist(lat1,lng1,lat2,lng2){const R=6371000,dLat=(lat2-lat1)*Math.PI/180,dLng=(lng2-lng1)*Math.PI/180,a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)*Math.sin(dLng/2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return Math.round(R*c)}
function getInit(n){return n.split(' ').map(x=>x[0]).join('').toUpperCase().substring(0,2)}
function selType(t){S.userType=t;R()}
function chLang(l){S.lang=l;R()}
function goBack(){S.userType=null;S.currentGroup=null;S.groupCode='';S.userName='';S.userPhoto=null;S.viewPilgrimProgress=null;S.viewQuestions=false;R()}
function createGrp(){const existingPilgrims=localStorage.getItem('pilgrims');let c;if(!existingPilgrims||JSON.parse(existingPilgrims).length===0){c='DEMO01'}else{c=Math.random().toString(36).substring(2,8).toUpperCase()}S.currentGroup=c;S.groupCode=c;const storedPilgrims=localStorage.getItem('pilgrims');if(storedPilgrims){S.pilgrims=JSON.parse(storedPilgrims).filter(p=>p.groupCode===c)}initDemo();R()}
function joinGrp(){const c=document.getElementById('codeIn').value;if(c&&c.length>=6){const code=c.toUpperCase();const storedPilgrims=localStorage.getItem('pilgrims');if(storedPilgrims){S.pilgrims=JSON.parse(storedPilgrims)}const pilgrim=S.pilgrims.find(p=>p.code===code);if(pilgrim){S.userName=pilgrim.name;S.userHotel=pilgrim.hotel||'';S.userRoom=pilgrim.room||'';S.userPhoto=pilgrim.photo||null;S.pilgrimCode=code;S.currentGroup=pilgrim.groupCode;S.completedSteps=pilgrim.completedSteps||{1:false,2:false,3:false,4:false,5:false};S.pilgrimPresence={};S.activities=[{id:1,name:'Visite MosquÃ©e du ProphÃ¨te',location:'MÃ©dine',time:'09:00'},{id:2,name:'Tawaf de groupe',location:'Masjid al-Haram',time:'14:00'}];R()}else{alert('Code invalide. Veuillez vÃ©rifier votre code.')}}}
function hdlPhoto(e){const f=e.target.files[0];if(f){const r=new FileReader();r.onload=x=>{S.userPhoto=x.target.result;if(S.userType==='pilgrim'&&S.pilgrimCode){const storedPilgrims=localStorage.getItem('pilgrims');if(storedPilgrims){S.pilgrims=JSON.parse(storedPilgrims)}const pilgrim=S.pilgrims.find(p=>p.code===S.pilgrimCode);if(pilgrim){pilgrim.photo=x.target.result;localStorage.setItem('pilgrims',JSON.stringify(S.pilgrims))}}R()};r.readAsDataURL(f)}}
function togRite(i){S.expandedRite=S.expandedRite===i?null:i;R()}
function compStp(i){if(S.userType==='pilgrim'){S.completedSteps[i]=!S.completedSteps[i];R()}}
function valPres(i){if(S.userType==='pilgrim'){S.pilgrimPresence[i]=true;R()}}
function shwAsk(){S.showAskQuestion=true;R()}
function hidAsk(){S.showAskQuestion=false;R()}
function askQ(){const q=document.getElementById('qTxt').value;if(q&&S.userType==='pilgrim'){S.questions=S.questions||[];S.questions.unshift({id:Date.now(),pilgrimName:S.userName,question:q,time:new Date(),answered:false,response:null});S.showAskQuestion=false;R()}}
function shwQs(){S.viewQuestions=true;R()}
function hidQs(){S.viewQuestions=false;R()}
function ansQ(i){const r=document.getElementById(`rsp-${i}`).value;if(r){const q=S.questions.find(x=>x.id===i);if(q){q.answered=true;q.response=r;R()}}}
function incTaw(){if(S.tawafCount<7){S.tawafCount++;if(S.tawafCount===7&&S.userType==='pilgrim'){S.completedSteps[2]=true}R()}}
function rstTaw(){S.tawafCount=0;if(S.userType==='pilgrim'){S.completedSteps[2]=false}R()}
function incSai(){if(S.saiCount<7){S.saiCount++;if(S.saiCount===7&&S.userType==='pilgrim'){S.completedSteps[4]=true}R()}}
function rstSai(){S.saiCount=0;if(S.userType==='pilgrim'){S.completedSteps[4]=false}R()}
function shwMsg(){S.showAddMessage=true;R()}
function hidMsg(){S.showAddMessage=false;R()}
function sndMsg(){const t=document.getElementById('msgT').value,c=document.getElementById('msgC').value;if(t&&c){S.messages.unshift({id:Date.now(),title:t,content:c,time:new Date()});S.showAddMessage=false;R()}}
function delMsg(i){S.messages=S.messages.filter(m=>m.id!==i);R()}
function shwPil(){S.showAddPilgrim=true;R()}
function hidPil(){S.showAddPilgrim=false;R()}
function shwEditPil(id){S.editPilgrimId=id;S.showEditPilgrim=true;R()}
function hidEditPil(){S.showEditPilgrim=false;S.editPilgrimId=null;R()}
function updatePil(){const h=document.getElementById('editH').value,r=document.getElementById('editR').value;if(S.editPilgrimId){const storedPilgrims=localStorage.getItem('pilgrims');if(storedPilgrims){S.pilgrims=JSON.parse(storedPilgrims)}const pilgrim=S.pilgrims.find(p=>p.id===S.editPilgrimId);if(pilgrim){pilgrim.hotel=h||'';pilgrim.room=r||'';localStorage.setItem('pilgrims',JSON.stringify(S.pilgrims))}S.showEditPilgrim=false;S.editPilgrimId=null;R()}}
function savPil(){const n=document.getElementById('pilN').value,h=document.getElementById('pilH').value,r=document.getElementById('pilR').value;if(n){const code=Math.random().toString(36).substring(2,8).toUpperCase();S.pilgrims.push({id:Date.now(),name:n,hotel:h||'',room:r||'',code:code,groupCode:S.currentGroup,photo:null,online:false,lat:21.4225+Math.random()*0.01,lng:39.8262+Math.random()*0.01,completedSteps:{1:false,2:false,3:false,4:false,5:false}});localStorage.setItem('pilgrims',JSON.stringify(S.pilgrims));S.showAddPilgrim=false;R()}}
function delPil(i){S.pilgrims=S.pilgrims.filter(p=>p.id!==i);R()}
function shwAct(){S.showAddActivity=true;R()}
function hidAct(){S.showAddActivity=false;R()}
function savAct(){const n=document.getElementById('actN').value,l=document.getElementById('actL').value,t=document.getElementById('actT').value;if(n&&l&&t){S.activities.push({id:Date.now(),name:n,location:l,time:t,presence:{}});S.showAddActivity=false;R()}}
function delAct(i){S.activities=S.activities.filter(a=>a.id!==i);R()}
function togPres(a,p){const act=S.activities.find(x=>x.id===a);if(act){if(!act.presence)act.presence={};act.presence[p]=!act.presence[p];R()}}
function viewProg(i){S.viewPilgrimProgress=i;R()}
function closeProg(){S.viewPilgrimProgress=null;R()}
function R(){const app=document.getElementById('app'),L=S.lang,tr=T[L];if(!S.userType){app.innerHTML=rSelType(tr)}else if(!S.currentGroup){app.innerHTML=rJoin(tr)}else if(S.viewPilgrimProgress){app.innerHTML=rProgView(tr,L)}else if(S.viewQuestions){app.innerHTML=rQView(tr)}else{app.innerHTML=rMain(tr,L)}}
function rSelType(t){return `<div class="container"><div class="card"><div class="icon-circle"><svg width="32" height="32" fill="white" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg></div><h1>${t.appTitle}</h1><p style="text-align:center;margin-bottom:30px">${t.userType}</p><button class="btn-primary" onclick="selType('guide')">${t.guide}</button><button class="btn-secondary" onclick="selType('pilgrim')">${t.pilgrims}</button><div style="text-align:center;margin-top:20px"><select onchange="chLang(this.value)" style="width:auto;display:inline-block"><option value="fr" ${S.lang==='fr'?'selected':''}>FranÃ§ais</option><option value="en" ${S.lang==='en'?'selected':''}>English</option></select></div></div></div>`}
function rJoin(t){return `<div class="container"><div class="card"><button class="btn-secondary" onclick="goBack()" style="margin-bottom:20px">${t.back}</button><h2>${S.userType==='guide'?t.create:t.join}</h2>${S.userType==='guide'?`<button class="btn-primary" onclick="createGrp()">${t.create}</button>`:`<p style="text-align:center;margin-bottom:20px;color:#6b7280">Entrez le code personnel fourni par votre guide</p><input type="text" id="codeIn" placeholder="${t.enterCode}" maxlength="6" style="text-transform:uppercase;text-align:center;font-size:24px;font-weight:bold"><button class="btn-primary" onclick="joinGrp()">${t.join}</button>`}</div></div>`}
function rQView(t){const un=S.questions.filter(q=>!q.answered).length;return `<div class="container"><div class="card"><button class="btn-secondary" onclick="hidQs()" style="margin-bottom:20px">${t.back}</button><h2>${t.pilgrimsQuestions} ${un>0?`<span class="badge badge-warning">${un}</span>`:''}</h2>${S.questions.length===0?`<p style="text-align:center;color:#6b7280;padding:40px 0">${t.noQuestions}</p>`:S.questions.map(q=>`<div class="question-item"><div class="flex-between" style="margin-bottom:10px"><h3 style="margin:0">${q.pilgrimName}</h3>${q.answered?'<span class="badge badge-success">'+t.answered+'</span>':'<span class="badge badge-warning">'+t.awaitingResponse+'</span>'}</div><p style="margin:10px 0;padding:10px;background:white;border-radius:8px">${q.question}</p><p class="message-time">${fmtTime(q.time)}</p>${q.answered?`<div class="question-response"><strong>${t.response}:</strong> ${q.response}</div>`:`<div style="margin-top:15px"><textarea id="rsp-${q.id}" placeholder="${t.response}..." style="margin-bottom:10px"></textarea><button class="btn-primary btn-small" onclick="ansQ(${q.id})">${t.answer}</button></div>`}</div>`).join('')}</div></div>`}
function rProgView(t,L){const p=S.pilgrims.find(x=>x.id===S.viewPilgrimProgress);if(!p)return '';const rts=RITES[L],prog=calcProg(p.completedSteps),cnt=getCnt(p.completedSteps);return `<div class="container"><div class="card"><button class="btn-secondary" onclick="closeProg()" style="margin-bottom:20px">${t.back}</button><h2>${t.pilgrimProgress}</h2><h3 style="text-align:center;color:#059669;margin-bottom:20px">${p.name}</h3><div class="progress-bar"><div class="progress-fill" style="width:${prog}%"></div></div><p class="progress-text">${cnt} ${t.of} 5 ${t.stepsCompleted} (${prog}%)</p><div style="margin-top:30px">${rts.map((r,i)=>{const done=p.completedSteps&&p.completedSteps[r.id];return `<div class="rite-item ${done?'completed':''}"><div class="rite-header"><div style="display:flex;align-items:center;flex:1"><div class="rite-number ${done?'completed':''}">${i+1}</div><div style="flex:1"><h3 style="margin:0">${r.title}</h3><p style="margin:5px 0 0 0;font-size:14px;color:${done?'#059669':'#6b7280'}">${done?t.completed:t.notStarted}</p></div></div>${done?'<span class="checkmark">âœ“</span>':''}</div></div>`}).join('')}</div></div></div>`}
function rMain(t,L){const rts=RITES[L];if(S.userType==='pilgrim'&&S.pilgrimCode){const storedPilgrims=localStorage.getItem('pilgrims');if(storedPilgrims){const allPilgrims=JSON.parse(storedPilgrims);const currentPilgrim=allPilgrims.find(p=>p.code===S.pilgrimCode);if(currentPilgrim){S.userHotel=currentPilgrim.hotel||'';S.userRoom=currentPilgrim.room||'';S.userPhoto=currentPilgrim.photo||null}}}let hdr='';if(S.userType==='pilgrim'){const prog=calcProg(S.completedSteps),init=getInit(S.userName);hdr=`<div class="profile-section"><div class="profile-photo">${S.userPhoto?`<img src="${S.userPhoto}" alt="${S.userName}">`

:init}</div><h2 style="margin:0 0 5px 0;text-align:center">${S.userName}</h2>${S.userHotel||S.userRoom?`<p style="text-align:center;font-size:14px;color:#047857;margin:5px 0 10px 0;font-weight:500">${S.userHotel?`ğŸ¨ ${S.userHotel}`:''} ${S.userRoom?`â€¢ ğŸšª Chambre ${S.userRoom}`:''}</p>`:''}<label for="photoUpload" class="btn-secondary btn-small" style="cursor:pointer;display:inline-block;margin:10px auto">ğŸ“¸ ${S.userPhoto?'Changer':'Ajouter'} photo</label><input type="file" id="photoUpload" accept="image/*" onchange="hdlPhoto(event)" style="display:none"><div class="progress-bar" style="margin:10px 0"><div class="progress-fill" style="width:${prog}%"></div></div><p style="text-align:center;font-size:14px;font-weight:600;color:#059669;margin:0">${getCnt(S.completedSteps)} / 5 ${t.stepsCompleted}</p></div>`}else{const unQ=S.questions.filter(q=>!q.answered).length;hdr=`<h1 style="margin-bottom:5px">${t.appTitle}</h1><p style="text-align:center;color:#6b7280">${t.guide}</p>${unQ>0?`<div style="text-align:center;margin-top:15px"><button class="btn-warning btn-small" onclick="shwQs()">${t.questions} <span class="badge badge-warning" style="margin-left:5px">${unQ}</span></button></div>`:''}`}let tabs='';if(S.userType==='guide'){tabs=`<button class="tab ${S.activeTab==='rites'?'active':''}" onclick="S.activeTab='rites';R()">${t.rites}</button><button class="tab ${S.activeTab==='progress'?'active':''}" onclick="S.activeTab='progress';R()">${t.progress}</button><button class="tab ${S.activeTab==='messages'?'active':''}" onclick="S.activeTab='messages';R()">${t.messages}</button><button class="tab ${S.activeTab==='rooms'?'active':''}" onclick="S.activeTab='rooms';R()">${t.rooms}</button><button class="tab ${S.activeTab==='map'?'active':''}" onclick="S.activeTab='map';R()">${t.map}</button><button class="tab ${S.activeTab==='presence'?'active':''}" onclick="S.activeTab='presence';R()">${t.presence}</button>`}else{tabs=`<button class="tab ${S.activeTab==='rites'?'active':''}" onclick="S.activeTab='rites';R()">${t.rites}</button><button class="tab ${S.activeTab==='detailed'?'active':''}" onclick="S.activeTab='detailed';R()">${t.detailedGuide}</button><button class="tab ${S.activeTab==='guide'?'active':''}" onclick="S.activeTab='guide';R()">${t.guideLocation}</button><button class="tab ${S.activeTab==='activities'?'active':''}" onclick="S.activeTab='activities';R()">${t.activities}</button><button class="tab ${S.activeTab==='questions'?'active':''}" onclick="S.activeTab='questions';R()">${t.questions}</button>`}return `<div class="header">${hdr}${S.userType==='guide'?`<div class="code-display">${S.currentGroup}</div><p style="text-align:center;font-size:12px;color:#6b7280">${t.shareCode}</p>`:''}<div style="text-align:center;margin-top:15px"><button onclick="chLang('fr')" style="background:${L==='fr'?'#059669':'transparent'};border:2px solid #059669;border-radius:8px;padding:8px 12px;font-size:24px;cursor:pointer;margin:0 5px;transition:all 0.3s">ğŸ‡«ğŸ‡·</button><button onclick="chLang('en')" style="background:${L==='en'?'#059669':'transparent'};border:2px solid #059669;border-radius:8px;padding:8px 12px;font-size:24px;cursor:pointer;margin:0 5px;transition:all 0.3s">ğŸ‡¬ğŸ‡§</button></div></div><div class="tab-bar">${tabs}</div><div class="container">${rTab(t,L,rts)}</div>`}
function rTab(t,L,rts){switch(S.activeTab){case 'rites':return rRites(t,rts);case 'detailed':return rDetailed(t,L);case 'progress':return rProg(t);case 'guide':return rGuideLoc(t);case 'activities':return rMyActs(t);case 'questions':return rMyQs(t);case 'messages':return rMsgs(t);case 'rooms':return rRooms(t);case 'map':return rMap(t);case 'presence':return rPresence(t);default:return ''}}
function rRites(t,rts){const isP=S.userType==='pilgrim';return `<h2 style="margin-bottom:20px">${t.rites}</h2>${rts.map((r,i)=>{const done=isP&&S.completedSteps&&S.completedSteps[r.id];return `<div class="rite-item ${done?'completed':''}"><div class="rite-header" onclick="togRite(${r.id})"><div style="display:flex;align-items:center;flex:1"><div class="rite-number ${done?'completed':''}">${i+1}</div><div style="flex:1"><h3 style="margin:0">${r.title}</h3><p style="margin:5px 0 0 0;font-size:14px">${r.description}</p>${isP?`<p style="margin:5px 0 0 0;font-size:13px;font-weight:600;color:${done?'#10b981':'#6b7280'}">${done?t.completed:t.notStarted}</p>`:''}</div></div><div style="font-size:24px;color:#059669">${S.expandedRite===r.id?'âˆ’':'+'}</div></div>${S.expandedRite===r.id?`<div class="rite-content"><h3>${t.steps}</h3><ol>${r.steps.map(s=>`<li>${s}</li>`).join('')}</ol><h3 style="margin-top:20px">${t.invocation}</h3><div class="dua-box"><div class="arabic-text">${r.dua.arabic}</div></div><div class="dua-box"><span class="label">${t.phonetic}</span><div class="phonetic-text">${r.dua.phonetic}</div></div><div class="dua-box"><span class="label">${t.translation}</span><div class="translation-text">${r.dua.translation}</div></div>${isP&&r.id!==2&&r.id!==4?`<div style="margin-top:20px"><button class="${done?'btn-completed':'btn-success'}" onclick="compStp(${r.id})">${done?t.completed:t.markComplete}</button></div>`:''}${r.id===2?`<div style="margin-top:20px;background:white;padding:20px;border-radius:15px;border:2px solid #059669"><h3 style="text-align:center">${t.counter}</h3><div class="counter-circle"><div class="counter-number">${S.tawafCount}</div></div><p style="text-align:center;font-weight:600;margin-bottom:15px">${t.round} ${S.tawafCount}/7</p>${S.tawafCount<7?`<button class="btn-primary" onclick="incTaw()">+ 1 ${t.round}</button>`:`<div class="success-box"><div class="success-text">${t.tawafComplete}</div></div><button class="btn-reset" onclick="rstTaw()">${t.reset}</button>`}</div>`:''}${r.id===4?`<div style="margin-top:20px;background:white;padding:20px;border-radius:15px;border:2px solid #059669"><h3 style="text-align:center">${t.counter}</h3><div class="counter-circle"><div class="counter-number">${S.saiCount}</div></div><p style="text-align:center;font-weight:600;margin-bottom:15px">${t.trip} ${S.saiCount}/7</p>${S.saiCount<7?`<button class="btn-primary" onclick="incSai()">+ 1 ${t.trip}</button>`:`<div class="success-box"><div class="success-text">${t.saiComplete}</div></div><button class="btn-reset" onclick="rstSai()">${t.reset}</button>`}</div>`:''}</div>`:''}</div>`}).join('')}`}
function rDetailed(t,L){return `<h2 style="margin-bottom:20px">ğŸ“– Guide Complet de la Oumra</h2><div class="card" style="background:linear-gradient(135deg,#f0fdf4 0%,#dcfce7 100%);border:2px solid #059669"><h3 style="color:#047857">ğŸ¯ But de l'Ihram</h3><div style="display:flex;align-items:start;gap:10px;margin:10px 0"><span style="color:#059669;font-size:20px">âœ“</span><p style="margin:0"><strong>Montrer sa soumission totale Ã  Allah</strong> - Se mettre entiÃ¨rement dans un Ã©tat d'adoration</p></div><div style="display:flex;align-items:start;gap:10px;margin:10px 0"><span style="color:#059669;font-size:20px">âœ“</span><p style="margin:0"><strong>Se dÃ©tacher des besoins et dÃ©sirs mondains</strong> pour se concentrer sur le rituel</p></div><div style="display:flex;align-items:start;gap:10px;margin:10px 0"><span style="color:#059669;font-size:20px">âœ“</span><p style="margin:0"><strong>Entrer dans un Ã©tat de puretÃ© spirituelle et morale</strong></p></div></div><div class="card" style="background:#fff;border:2px solid #d1fae5"><h3 style="color:#047857">ğŸ“ Ã‰tape 1 : Faire le Ghusl (Purification)</h3><p>Se laver complÃ¨tement le corps avant d'entrer en Ã©tat d'Ihram</p></div><div class="card" style="background:#fff;border:2px solid #d1fae5"><h3 style="color:#047857">ğŸ‘• Ã‰tape 2 : Porter l'Ihram</h3><p><strong>Hommes :</strong> 2 piÃ¨ces de tissu blanc non cousu</p><p><strong>Femmes :</strong> VÃªtements modestes (pas de tenue obligatoire spÃ©cifique)</p></div><div class="card" style="background:#fff;border:2px solid #d1fae5"><h3 style="color:#047857">ğŸ¤² Ã‰tape 3 : Formuler l'intention (Niyyah)</h3><div class="dua-box" style="margin-top:15px"><h4 style="color:#059669;margin-bottom:10px">Pour soi-mÃªme :</h4><div class="arabic-text">Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¹ÙÙ…Ù’Ø±ÙØ©Ù‹</div><p class="phonetic-text" style="margin:10px 0">Labbayka AllÄhoumma 'Umratan</p><p class="translation-text">Je rÃ©ponds Ã  ton appel, Ã” Allah par une Oumra</p></div><div class="dua-box" style="margin-top:15px"><h4 style="color:#059669;margin-bottom:10px">Pour une autre personne :</h4><div class="arabic-text">Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¹ÙÙ…Ù’Ø±ÙØ©Ù‹ Ø¹ÙÙ†Ù’ [ÙÙÙ„ÙØ§Ù†Ù Ø¨Ù’Ù†Ù ÙÙÙ„ÙØ§Ù†Ù]</div><p class="phonetic-text" style="margin:10px 0">Labbayka Allahoumma 'umrah 'an [Foulan ibn foulan]</p><p class="translation-text">Me voici, Ã” Allah, pour la Omra pour [nom de la personne fils d'un tel]</p></div></div><div class="card" style="background:#fff;border:2px solid #d1fae5"><h3 style="color:#047857">ğŸ•Œ Ã‰tape 4 : Se rendre Ã  Masjid Al-Haram</h3><p>RÃ©citer frÃ©quemment la Talbiya en chemin</p><div class="dua-box" style="margin-top:10px"><div class="arabic-text">Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù„ÙØ¨ÙÙ‘ÙŠÙ’ÙƒÙ</div><p class="phonetic-text" style="margin:10px 0">Labbayka AllÄhoumma labbayk</p></div></div><div class="card" style="background:#fff;border:2px solid #d1fae5"><h3 style="color:#047857">ğŸ•‹ Ã‰tape 5 : Tawaf - 7 tours autour de la Ka'ba</h3><p>Commencer au niveau de la Pierre Noire, faire 7 tours dans le sens antihoraire</p></div><div class="card" style="background:#fff;border:2px solid #d1fae5"><h3 style="color:#047857">ğŸ™ Ã‰tape 6 : PriÃ¨re de 2 Rak'at derriÃ¨re Maqam Ibrahim</h3><p>Accomplir 2 unitÃ©s de priÃ¨re aprÃ¨s le Tawaf</p></div><div class="card" style="background:#fff;border:2px solid #d1fae5"><h3 style="color:#047857">ğŸ’§ Ã‰tape 7 : Boire l'eau de Zamzam</h3><p>Boire de l'eau de Zamzam et faire des invocations</p><div class="dua-box" style="margin-top:10px;background:#e0f2fe"><p style="color:#0369a1;margin:0">ğŸ’¡ <strong>Conseil :</strong> Boire en Ã©tant debout, face Ã  la Ka'ba, en invoquant Allah pour ce que vous dÃ©sirez</p></div></div><div class="card" style="background:#fff;border:2px solid #d1fae5"><h3 style="color:#047857">ğŸƒ Ã‰tape 8 : Sa'i - 7 allers-retours entre Safa et Marwa</h3><p>Commencer Ã  Safa, marcher jusqu'Ã  Marwa et rÃ©pÃ©ter 7 fois</p></div><div class="card" style="background:#fff;border:2px solid #d1fae5"><h3 style="color:#047857">âœ‚ï¸ Ã‰tape 9 : Se raser ou raccourcir les cheveux</h3><p><strong>Hommes :</strong> Raser (Halq) ou raccourcir (Taqsir)</p><p><strong>Femmes :</strong> Couper l'Ã©quivalent d'une phalange</p></div><div class="card" style="background:#fff;border:2px solid #d1fae5"><h3 style="color:#047857">ğŸŠ Ã‰tape 10 : Sortir de l'Ã©tat d'Ihram</h3><p style="color:#059669;font-weight:600;font-size:18px">âœ¨ FÃ©licitations ! Votre Oumra est terminÃ©e âœ¨</p><p>Vous pouvez maintenant reprendre vos activitÃ©s normales</p></div><div class="success-box" style="margin-top:20px"><div class="success-text">ğŸ¤² Qu'Allah accepte votre Oumra</div></div>`}
function rGuideLoc(t){const pLat=21.4230,pLng=39.8268,dist=calcDist(pLat,pLng,S.guideLocation.lat,S.guideLocation.lng);return `<h2 style="margin-bottom:20px">${t.guideLocation}</h2><div class="guide-location-card"><h3 style="text-align:center;color:#1e40af;margin-bottom:15px">${t.guideDistance}</h3><div class="distance-display">${dist} ${t.meters}</div><div class="map-placeholder" style="margin-top:20px"><div style="text-align:center;z-index:10"><svg width="48" height="48" fill="#047857" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg><p style="color:#047857;font-weight:600;margin-top:10px">${t.findGuide}</p></div><div style="position:absolute;left:50%;top:50%;width:40px;height:40px;background:#3b82f6;border-radius:50%;border:4px solid white;box-shadow:0 4px 10px rgba(0,0,0,0.3);transform:translate(-50%,-50%)"></div><div style="position:absolute;left:60%;top:40%;width:30px;height:30px;background:#059669;border-radius:50%;border:3px solid white;box-shadow:0 4px 10px rgba(0,0,0,0.2)"></div></div><p style="text-align:center;margin-top:15px;font-size:13px;color:#1e40af">ğŸ“ Position mise Ã  jour en temps rÃ©el</p></div><div class="card" style="margin-top:20px;background:#fef3c7;border:2px solid #f59e0b"><h3 style="color:#92400e">ğŸ’¡ Conseil</h3><p style="color:#78350f;margin:0">Gardez cette page ouverte pour suivre le guide en temps rÃ©el.</p></div>`}
function rMyActs(t){return `<h2 style="margin-bottom:20px">${t.myActivities}</h2>${S.activities.length===0?`<p style="text-align:center;color:#6b7280;padding:40px 0">${t.noActivities}</p>`:S.activities.map(a=>{const val=S.pilgrimPresence[a.id];return `<div class="activity-item"><div style="margin-bottom:15px"><h3 style="margin:0 0 5px 0">${a.name}</h3><p style="margin:0;font-size:14px;color:#6b7280">ğŸ“ ${a.location}</p><p style="margin:5px 0 0 0;font-size:14px;color:#6b7280">ğŸ• ${a.time}</p></div>${val?`<div class="success-box"><div class="success-text">${t.presenceValidated}</div></div>`:`<button class="btn-success" onclick="valPres(${a.id})">${t.validatePresence}</button>`}</div>`}).join('')}`}
function rMyQs(t){const myQ=S.questions.filter(q=>q.pilgrimName===S.userName);return `<div class="flex-between" style="margin-bottom:20px"><h2 style="margin:0">${t.yourQuestions}</h2><button class="btn-primary btn-small" onclick="shwAsk()">+ ${t.askQuestion}</button></div>${S.showAskQuestion?`<div class="card" style="background:#f0fdf4"><h3>${t.askQuestion}</h3><textarea id="qTxt" placeholder="${t.questionPlaceholder}"></textarea><div class="flex-row"><button class="btn-primary" onclick="askQ()">${t.send}</button><button class="btn-secondary" onclick="hidAsk()">${t.cancel}</button></div></div>`:''}${myQ.length===0?`<p style="text-align:center;color:#6b7280;padding:40px 0">${t.noQuestions}</p>`:myQ.map(q=>`<div class="question-item"><div class="flex-between" style="margin-bottom:10px"><p class="message-time">${fmtTime(q.time)}</p>${q.answered?'<span class="badge badge-success">'+t.answered+'</span>':'<span class="badge badge-warning">'+t.awaitingResponse+'</span>'}</div><p style="margin:10px 0;padding:10px;background:white;border-radius:8px">${q.question}</p>${q.answered?`<div class="question-response"><strong>${t.response}:</strong> ${q.response}</div>`:''}</div>`).join('')}`}
function rProg(t){return `<h2 style="margin-bottom:20px">${t.progress}</h2>${S.pilgrims.length===0?`<p style="text-align:center;color:#6b7280;padding:40px 0">${t.noPilgrims}</p>`:S.pilgrims.map(p=>{const prog=calcProg(p.completedSteps),cnt=getCnt(p.completedSteps);return `<div class="pilgrim-item"><div class="flex-between" style="margin-bottom:10px"><div style="flex:1"><h3 style="margin:0">${p.name}</h3></div><button class="btn-primary btn-small" onclick="viewProg(${p.id})">${t.viewProgress}</button></div><div class="progress-bar"><div class="progress-fill" style="width:${prog}%"></div></div><p style="font-size:13px;color:#059669;font-weight:600;margin-top:5px">${cnt} ${t.of} 5 ${t.stepsCompleted} (${prog}%)</p>${prog===100?'<span class="badge badge-success">âœ“ Oumrah terminÃ©e</span>':''}${prog===0?'<span class="badge badge-warning">Pas commencÃ©</span>':''}</div>`}).join('')}`}
function rMsgs(t){return `<div class="flex-between" style="margin-bottom:20px"><h2 style="margin:0">${t.messages}</h2><button class="btn-primary btn-small" onclick="shwMsg()">+ ${t.addMessage}</button></div>${S.showAddMessage?`<div class="card" style="background:#f0fdf4"><h3>${t.addMessage}</h3><input type="text" id="msgT" placeholder="${t.messageTitle}"><textarea id="msgC" placeholder="${t.messageContent}"></textarea><div class="flex-row"><button class="btn-primary" onclick="sndMsg()">${t.send}</button><button class="btn-secondary" onclick="hidMsg()">${t.cancel}</button></div></div>`:''}${S.messages.length===0?`<p style="text-align:center;color:#6b7280;padding:40px 0">${t.noMessages}</p>`:S.messages.map(m=>`<div class="message-item"><div class="message-header"><h3 style="margin:0">${m.title}</h3><button class="btn-danger btn-small" onclick="delMsg(${m.id})">${t.delete}</button></div><p style="margin:10px 0">${m.content}</p><p class="message-time">${fmtTime(m.time)}</p></div>`).join('')}`}
function rRooms(t){const storedPilgrims=localStorage.getItem('pilgrims');if(storedPilgrims&&S.userType==='guide'){const allPilgrims=JSON.parse(storedPilgrims);S.pilgrims=allPilgrims.filter(p=>p.groupCode===S.currentGroup)}return `<div class="flex-between" style="margin-bottom:20px"><h2 style="margin:0">${t.rooms}</h2><button class="btn-primary btn-small" onclick="shwPil()">+ ${t.addPilgrim}</button></div>${S.showAddPilgrim?`<div class="card" style="background:#f0fdf4"><h3>${t.addPilgrim}</h3><input type="text" id="pilN" placeholder="${t.pilgrimName}"><input type="text" id="pilH" placeholder="Nom de l'hÃ´tel"><input type="text" id="pilR" placeholder="${t.roomNumber}"><div class="flex-row"><button class="btn-primary" onclick="savPil()">${t.save}</button><button class="btn-secondary" onclick="hidPil()">${t.cancel}</button></div></div>`:''}${S.showEditPilgrim?`<div class="card" style="background:#fff3cd;border:2px solid #f59e0b"><h3>âœï¸ Modifier l'hÃ´tel et la chambre</h3><input type="text" id="editH" placeholder="Nom de l'hÃ´tel" value="${S.pilgrims.find(p=>p.id===S.editPilgrimId)?.hotel||''}"><input type="text" id="editR" placeholder="${t.roomNumber}" value="${S.pilgrims.find(p=>p.id===S.editPilgrimId)?.room||''}"><div class="flex-row"><button class="btn-primary" onclick="updatePil()">${t.save}</button><button class="btn-secondary" onclick="hidEditPil()">${t.cancel}</button></div></div>`:''}${S.pilgrims.length===0?`<p style="text-align:center;color:#6b7280;padding:40px 0">${t.noPilgrims}</p>`:S.pilgrims.map(p=>{const init=getInit(p.name);return `<div class="pilgrim-item"><div class="flex-between"><div style="display:flex;align-items:center;gap:15px;flex:1"><div style="width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#059669 0%,#0d9488 100%);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:18px;overflow:hidden;flex-shrink:0">${p.photo?`<img src="${p.photo}" style="width:100%;height:100%;object-fit:cover" alt="${p.name}">`:init}</div><div style="flex:1"><h3 style="margin-bottom:5px">${p.name}</h3><div style="display:flex;gap:10px;margin:5px 0;flex-wrap:wrap">${p.hotel?`<span class="badge badge-info">ğŸ¨ ${p.hotel}</span>`:''}<span class="badge badge-info">ğŸšª ${p.room||'N/A'}</span><span class="badge badge-warning" style="font-family:monospace;font-size:13px">Code: ${p.code}</span></div></div></div><div style="display:flex;gap:5px"><button class="btn-warning btn-small" onclick="shwEditPil(${p.id})">âœï¸ Modifier</button><button class="btn-danger btn-small" onclick="delPil(${p.id})">${t.delete}</button></div></div></div>`}).join('')}`}
function rMap(t){return `<h2 style="margin-bottom:20px">${t.map}</h2><div class="card"><div style="background:linear-gradient(135deg,#d1fae5 0%,#a5f3fc 100%);height:300px;border-radius:15px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden"><p style="color:#047857;font-weight:600;z-index:10">Carte GPS interactive</p>${S.pilgrims.filter(p=>p.online).map((p,i)=>`<div style="position:absolute;left:${30+i*15}%;top:${40+i*10}%;width:30px;height:30px;background:#059669;border-radius:50%;border:3px solid white;box-shadow:0 4px 10px rgba(0,0,0,0.2)"></div>`).join('')}</div></div>${S.pilgrims.map(p=>`<div class="pilgrim-item"><div class="flex-between"><div><h3 style="margin:0">${p.name}</h3><p style="margin:5px 0 0 0;font-size:13px;color:#6b7280">${p.online?`<span class="status-online"></span>${t.online}`:`<span class="status-offline"></span>${t.offline}`}</p></div>${p.online?`<p style="color:#059669;font-weight:600;margin:0">~${Math.floor(Math.random()*500)+100}m</p>`:''}</div></div>`).join('')}`}
function rPresence(t){return `<div class="flex-between" style="margin-bottom:20px"><h2 style="margin:0">${t.presence}</h2><button class="btn-primary btn-small" onclick="shwAct()">+ ${t.addActivity}</button></div>${S.showAddActivity?`<div class="card" style="background:#f0fdf4"><h3>${t.addActivity}</h3><input type="text" id="actN" placeholder="${t.activityName}"><input type="text" id="actL" placeholder="${t.activityLocation}"><input type="time" id="actT"><div class="flex-row"><button class="btn-primary" onclick="savAct()">${t.save}</button><button class="btn-secondary" onclick="hidAct()">${t.cancel}</button></div></div>`:''}${S.activities.length===0?`<p style="text-align:center;color:#6b7280;padding:40px 0">${t.noActivities}</p>`:S.activities.map(a=>{const pCnt=Object.values(a.presence||{}).filter(p=>p).length;return `<div class="activity-item"><div class="flex-between" style="margin-bottom:10px"><div style="flex:1"><h3 style="margin:0 0 5px 0">${a.name}</h3><p style="margin:0;font-size:14px;color:#6b7280">ğŸ“ ${a.location} â€¢ ğŸ• ${a.time}</p><span class="badge badge-present">${pCnt} ${t.presenceCount}</span></div><button class="btn-danger btn-small" onclick="delAct(${a.id})">${t.delete}</button></div><div style="margin-top:15px;border-top:2px solid #e5e7eb;padding-top:15px"><h4 style="margin:0 0 10px 0;color:#059669;font-size:14px">${t.markPresence}</h4>${S.pilgrims.map(p=>{const pres=a.presence&&a.presence[p.id];return `<div class="checkbox-item"><input type="checkbox" ${pres?'checked':''} onchange="togPres(${a.id},${p.id})"><span>${p.name}</span>${pres?`<span class="badge badge-present" style="margin-left:auto">${t.present}</span>`:`<span class="badge badge-absent" style="margin-left:auto">${t.absent}</span>`}</div>`}).join('')}</div></div>`}).join('')}`}
R();
</script>
</body>
</html>
